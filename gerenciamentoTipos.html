<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gerenciamento de Tipos</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  h2 { margin-top: 40px; }
  label { display: block; margin-top: 10px; }
  input { padding: 5px; width: 250px; }
  button { margin-top: 10px; padding: 7px 15px; cursor: pointer; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
  th { background-color: #f2f2f2; }
  .btn-action { cursor: pointer; color: blue; text-decoration: underline; background:none; border:none; }
</style>
</head>
<body>

<h1>Gerenciamento de Tipos</h1>

<section id="cadastro">
  <h2>Cadastrar Tipo</h2>
  <form id="formCadastroTipo">
    <label>Nome do Tipo:</label>
    <input type="text" id="nomeTipo" required />
    <br/>
    <button type="submit">Cadastrar</button>
  </form>
  <div id="msgCadastroTipo"></div>
</section>

<section id="listaAtivos">
  <h2>Tipos Ativos</h2>
  <table>
    <thead>
      <tr><th>ID</th><th>Nome</th><th>Ação</th></tr>
    </thead>
    <tbody id="ativosBody"></tbody>
  </table>
</section>

<section id="listaInativos">
  <h2>Tipos Inativos</h2>
  <table>
    <thead>
      <tr><th>ID</th><th>Nome</th><th>Ação</th></tr>
    </thead>
    <tbody id="inativosBody"></tbody>
  </table>
</section>

<script>
const apiBase = 'http://localhost:8000';

async function carregarTipos() {
  const ativosRes = await fetch(`${apiBase}/tipos/ativos/`);
  const inativosRes = await fetch(`${apiBase}/tipos/inativos/`);
  const ativos = await ativosRes.json();
  const inativos = await inativosRes.json();

  const ativosBody = document.getElementById('ativosBody');
  const inativosBody = document.getElementById('inativosBody');

  ativosBody.innerHTML = '';
  ativos.forEach(t => {
    ativosBody.innerHTML += `
      <tr>
        <td>${t.id}</td>
        <td>${t.nome}</td>
        <td><button class="btn-action" onclick="alterarStatus(${t.id})">Desativar</button></td>
      </tr>
    `;
  });

  inativosBody.innerHTML = '';
  inativos.forEach(t => {
    inativosBody.innerHTML += `
      <tr>
        <td>${t.id}</td>
        <td>${t.nome}</td>
        <td><button class="btn-action" onclick="alterarStatus(${t.id})">Ativar</button></td>
      </tr>
    `;
  });
}

async function alterarStatus(tipoId) {
  try {
    const res = await fetch(`${apiBase}/tipo/${tipoId}/status/`, {
      method: 'PUT',
    });
    if (!res.ok) {
      throw new Error('Erro ao alterar status do tipo');
    }
    alert((await res.json()).message);
    carregarTipos();
  } catch (err) {
    alert(err.message);
  }
}

document.getElementById('formCadastroTipo').addEventListener('submit', async e => {
  e.preventDefault();
  const nome = document.getElementById('nomeTipo').value.trim();
  const msg = document.getElementById('msgCadastroTipo');
  msg.textContent = '';

  try {
    const res = await fetch(`${apiBase}/tipo/`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ nome }),
    });
    if (!res.ok) {
      const errData = await res.json();
      throw new Error(errData.detail || 'Erro ao cadastrar tipo');
    }
    msg.style.color = 'green';
    msg.textContent = 'Tipo cadastrado com sucesso!';
    e.target.reset();
    carregarTipos();
  } catch (err) {
    msg.style.color = 'red';
    msg.textContent = err.message;
  }
});

// Inicializa lista na carga da página
carregarTipos();
</script>

</body>
</html>
